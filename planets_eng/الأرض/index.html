<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Earth | Realistic 3D Experience</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            background-color: #000000;
            color: #ffffff;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            overflow: hidden;
            width: 100vw;
            height: 100vh;
        }

        #app {
            width: 100%;
            height: 100%;
        }

        #earth-canvas {
            width: 100%;
            height: 100%;
            display: block;
        }

        #ui-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 10;
        }

        .loader {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 15px;
            background: rgba(0, 0, 0, 0.7);
            padding: 20px 40px;
            border-radius: 12px;
            backdrop-filter: blur(5px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            transition: opacity 0.5s ease;
        }

        .spinner {
            width: 40px;
            height: 40px;
            border: 3px solid rgba(255, 255, 255, 0.1);
            border-top: 3px solid #00a2ff;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }
    </style>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div id="app">
        <canvas id="earth-canvas"></canvas>

        <!-- Planet Info Card -->
        <div class="planet-card">
            <h2>EARTH</h2>
            <div class="card-content">
                <div class="stat-item">
                    <span class="stat-label">DIAMETER</span>
                    <span class="stat-value">12,742 km</span>
                </div>
                <div class="stat-item">
                    <span class="stat-label">SUN DISTANCE</span>
                    <span class="stat-value">149.6 M km</span>
                </div>
                <div class="stat-item">
                    <span class="stat-label">DAY LENGTH</span>
                    <span class="stat-value">24 hours</span>
                </div>
                <div class="stat-item">
                    <span class="stat-label">YEAR LENGTH</span>
                    <span class="stat-value">365.25 days</span>
                </div>
            </div>
        </div>

        <div id="ui-overlay">
            <div class="loader" id="loader">
                <div class="spinner"></div>
                <p>Loading Planet...</p>
            </div>
        </div>
    </div>

    <!-- Usage of CDN for Three.js and OrbitControls -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/mrdoob/three.js@r128/examples/js/controls/OrbitControls.js"></script>
    <script src="../textures/embedded_textures.js"></script>

    <script>
        class EarthExperience {
            constructor() {
                this.canvas = document.querySelector('#earth-canvas');
                this.loaderElement = document.getElementById('loader');
                
                this.scene = new THREE.Scene();
                this.camera = new THREE.PerspectiveCamera(45, window.innerWidth / window.innerHeight, 0.1, 1000);
                this.camera.position.z = 3.5;
                
                this.renderer = new THREE.WebGLRenderer({
                    canvas: this.canvas,
                    antialias: true,
                    alpha: true
                });
                this.renderer.setSize(window.innerWidth, window.innerHeight);
                this.renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2));
                
                this.controls = new THREE.OrbitControls(this.camera, this.canvas);
                this.controls.enableDamping = true;
                this.controls.dampingFactor = 0.05;
                this.controls.minDistance = 1.5;
                this.controls.maxDistance = 10;

                this.textureLoader = new THREE.TextureLoader();
                
                this.addStars();
                this.addLights();
                this.createEarth();
                this.animate();
                
                window.addEventListener('resize', () => this.onResize());
            }

            addStars() {
                const starsGeometry = new THREE.BufferGeometry();
                const count = 5000;
                const positions = new Float32Array(count * 3);
                
                for(let i = 0; i < count * 3; i++) {
                    positions[i] = (Math.random() - 0.5) * 600;
                }
                
                starsGeometry.setAttribute('position', new THREE.BufferAttribute(positions, 3));
                
                const canvas = document.createElement('canvas');
                canvas.width = 32;
                canvas.height = 32;
                const context = canvas.getContext('2d');
                const gradient = context.createRadialGradient(16, 16, 0, 16, 16, 16);
                gradient.addColorStop(0, 'rgba(255, 255, 255, 1)');
                gradient.addColorStop(0.2, 'rgba(255, 255, 255, 0.8)');
                gradient.addColorStop(0.5, 'rgba(255, 255, 255, 0.2)');
                gradient.addColorStop(1, 'rgba(0, 0, 0, 0)');
                context.fillStyle = gradient;
                context.fillRect(0, 0, 32, 32);
                
                const starTexture = new THREE.CanvasTexture(canvas);

                const starsMaterial = new THREE.PointsMaterial({
                    map: starTexture,
                    size: 0.7,
                    transparent: true,
                    opacity: 0.9,
                    sizeAttenuation: true,
                    color: 0xffffff,
                    blending: THREE.AdditiveBlending,
                    depthWrite: false
                });
                
                const starField = new THREE.Points(starsGeometry, starsMaterial);
                this.scene.add(starField);
            }

            addLights() {
                const sunLight = new THREE.DirectionalLight(0xffffff, 1.2); 
                sunLight.position.set(-5, 3, 5);
                this.scene.add(sunLight);

                const ambientLight = new THREE.AmbientLight(0x404060, 2.5); 
                this.scene.add(ambientLight);
                
                const backLight = new THREE.DirectionalLight(0x222244, 1.0);
                backLight.position.set(10, 0, -10);
                this.scene.add(backLight);
            }

            createEarth() {
                const geometry = new THREE.SphereGeometry(1, 64, 64);
                
                const textures = {
                    day: EARTH_DATA,
                    specular: 'https://raw.githubusercontent.com/mrdoob/three.js/master/examples/textures/planets/earth_specular_2048.jpg',
                    normal: 'https://raw.githubusercontent.com/mrdoob/three.js/master/examples/textures/planets/earth_normal_2048.jpg',
                    clouds: 'https://raw.githubusercontent.com/mrdoob/three.js/master/examples/textures/planets/earth_clouds_1024.png'
                };

                const material = new THREE.MeshPhongMaterial({
                    map: this.textureLoader.load(textures.day, () => {
                        this.loaderElement.style.opacity = '0';
                        setTimeout(() => this.loaderElement.style.display = 'none', 500);
                    }),
                    specularMap: this.textureLoader.load(textures.specular),
                    normalMap: this.textureLoader.load(textures.normal),
                    normalScale: new THREE.Vector2(0.8, 0.8),
                    specular: new THREE.Color(0x222222), 
                    shininess: 10 
                });

                this.earth = new THREE.Mesh(geometry, material);
                this.scene.add(this.earth);

                // Clouds
                const cloudGeometry = new THREE.SphereGeometry(1.02, 64, 64);
                const cloudMaterial = new THREE.MeshPhongMaterial({
                    map: this.textureLoader.load(textures.clouds),
                    transparent: true,
                    opacity: 0.4,
                    blending: THREE.AdditiveBlending
                });
                this.clouds = new THREE.Mesh(cloudGeometry, cloudMaterial);
                this.scene.add(this.clouds);

                // Atmosphere
                const atmosphereGeometry = new THREE.SphereGeometry(1.2, 64, 64); 
                const atmosphereMaterial = new THREE.ShaderMaterial({
                    transparent: true,
                    side: THREE.BackSide,
                    uniforms: {
                        c: { type: "f", value: 0.4 },
                        p: { type: "f", value: 5.0 },
                        glowColor: { type: "c", value: new THREE.Color(0xffffff) }, 
                        viewVector: { type: "v3", value: this.camera.position }
                    },
                    vertexShader: `
                        uniform vec3 viewVector;
                        varying float intensity;
                        void main() {
                            vec3 vNormal = normalize( normalMatrix * normal );
                            vec3 vNormel = normalize( normalMatrix * viewVector );
                            intensity = pow( 0.5 - dot(vNormal, vNormel), 4.0 );
                            gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
                        }
                    `,
                    fragmentShader: `
                        uniform vec3 glowColor;
                        varying float intensity;
                        void main() {
                            vec3 glow = glowColor * intensity;
                            gl_FragColor = vec4( glow, 0.5 );
                        }
                    `
                });
                this.atmosphere = new THREE.Mesh(atmosphereGeometry, atmosphereMaterial);
                this.scene.add(this.atmosphere);
            }

            onResize() {
                this.camera.aspect = window.innerWidth / window.innerHeight;
                this.camera.updateProjectionMatrix();
                this.renderer.setSize(window.innerWidth, window.innerHeight);
            }

            animate() {
                requestAnimationFrame(() => this.animate());
                
                if (this.earth) this.earth.rotation.y += 0.001;
                if (this.clouds) this.clouds.rotation.y += 0.0015;
                
                this.controls.update();
                this.renderer.render(this.scene, this.camera);
            }
        }

        window.onload = () => {
            new EarthExperience();
        };
    </script>
</body>
</html>
